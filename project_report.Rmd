---
title: "Project Report"
author: "Devanshi, Chinmay, Archie"
date: "4/23/2021"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(infer)
library (readr)
library(sf)

```
### INTRODUCTION AND DATA
##### Background and Motivation
The American police force is notorious for needlessly beating and killing. Moreover, such killings and mistreatment tend to disproportionately impact Black Americans and other poc groups. In May of 2020, the issue again sparked outrage, as the nation watched policeman Derek Chauvin kill George Floyd on video. The event brought discussion on the impacts of police brutality, particularly on communities of color, to a national spotlight. Our research study will analyze which communities and groups of people are most impacted by police killings. 

##### Dataset in question
The data overviews the demographics of individuals killed by police in the United States. This data was collected from The Guardian’s database on police killings, and census data from the American Community Survey. The Guardian’s database data was collected through verified crowdsourcing. The data was collected in 2015, and was used in the FiveThirtyEight article “Where Police Have Killed Americans in 2015.” The data is posted to the github page “fivethirtyeight/data” and can be found by the link. Relevant variables in the dataset include raceethnicity : Race/ethnicity of deceased, state : State where incident occurred, share_white : share of population that is nonhispanic / white, share_bloack: share of population that is black, month: month of killing.

### Research Question and Hypothesis

GENERAL QUESTION: How do demographic factors differ among those who have been killed by the police?
GENERAL HYPOTHESIS: We predict that on average, more men are killed by the police than women for every race/ethnicity. Between the races, we expect that Black and Hispanic/Latino people, on average, come from lower socioeconomic class and therefore have lower household incomes, college graduation rates, and employment rates.

### Glimpse of Dataset:
Dataset: https://github.com/fivethirtyeight/data/tree/master/police-killings 
background reading: https://www.nytimes.com/2020/05/31/us/george-floyd-investigation.html 
```{r}
urlfile="https://raw.githubusercontent.com/fivethirtyeight/data/master/police-killings/police_killings.csv"
police_killings<-read_csv(url(urlfile))
police_killings <- police_killings %>% 
  mutate(urate = urate *100, college = college *100, pov = as.numeric(pov))
glimpse (police_killings)
```
##### Police killing cases by ethnicity
```{r}
police_killings <- police_killings %>%
drop_na

police_killings %>%
group_by(raceethnicity) %>%
  summarise(count = n())
```
^ need to talk about this? or get rid of it?
*spatial data make a map

#### USA Map of Police Killings

```{r policekillings_map}
police_killings_df <- read.csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/police-killings/police_killings.csv")
str(police_killings_df)

police_killings_sf <- st_as_sf(police_killings_df, coords = c("latitude", "longitude"))
str(police_killings_sf)

st_crs(police_killings_sf) <- 4326 
st_crs(police_killings_sf)

st_write(police_killings_sf, "data/police_killings", driver = "ESRI Shapefile")
st_write(police_killings_sf, "data/police_killings", driver = "ESRI Shapefile", delete_layer = TRUE)

  
```


https://cengel.github.io/R-spatial/intro.html
### METHODOLOGY
*theres like a summary statistics package thing we could use with household income as y var and group by race/ethnicity i think

##### Sub-question 1: Killing cases by GENDER
*Research Question*
Are men more likely to be killed by police? 
Null hypothesis: The proportion of male victims among police killing cases is not greater than 50%.
Alternative hypothesis: The proportion of male victims among police killing cases is greater than 50%.

Given $\mu1 = \mu(male)$ and $\mu2 = \mu(female)$:

$H_0: \mu1 = \mu2$

$H_1: \mu1 > \mu2$
*Methodology*
To answer the research question, we use Central Limit Theorem Based Hypothesis Testing. We use "prop_test" function from the "infer" package to test if the proportion of male victims is greater than 50%. If the p-value of it being less than 50% is smaller than 0.05, we have convincing evidence to reject the null hypothesis. If the p-value is greater than 0.05, then we fail to reject the null hypothesis. To make the p-value represent that of < 50%, we input alternative to be "greater" in the prop_test. We created a segmented bar plot to visualize the total men and women killed by police in each ethnicity group. Gender is represented by color.

```{r}
police_killings %>% 
  mutate(better = ifelse(gender == "Male", "better", "worse")) %>% 
  prop_test(response = better, success = "better", conf_int = FALSE, p = 0.5,
            alternative = "greater", z = TRUE)
```

```{r}
library(viridis)
ggplot(data = police_killings, mapping = aes(x = raceethnicity, fill = gender)) + 
  geom_bar() +
  coord_flip() + 
  scale_fill_viridis(discrete=TRUE, option = "D", name="gender") +
  labs(title= "Gender Distribution of Race/Ethnicity", x= "Race/Ethnicity", y="Count") +
  theme_bw()
```

justify the choice of statistical method(s) used to answer your research question

##### Sub-question 2: Household income by ethnicity
*Research Question*
Among those who were killed by police, are the household incomes of White individuals greater than Black & Hispanic/Latino individuals?

Null Hypothesis: The household incomes of White individuals who were killed by police are not greater than Black & Hispanic/Latino individuals who were killed by police.
Alternate Hypothesis: The household incomes of White individuals who were killed by police are greater than Black & Hispanic/Latino individuals who were killed by police.

Given $\mu1 = \mu(White)$ and $\mu2 = \mu(Black/Hispanic/Latino)$:

$H_0: \mu1 = \mu2$

$H_1: \mu1 > \mu2$
*Methodology*
To answer the research question, we constructed a 95% simulation based confidence interval. We use functions from the "infer" package to create 10,000 bootstrap simulation, calculate bootstrap stats "differences in means" , and construct a 95% confidence interval of difference of mean household income between white and non-white victims (h_income_white - h_income_B/H). To visualize the confidence interval and bootstrap distribution, we use visualize() & shade_confidence_interval() function. If the confidence interval on the plot captures zero, it means that we cannot rule out the possibility that household income of white people maybe lower than that of black&hispanic people and thus we fail to reject our null hypothesis. If the entire confidence interval is consistently positive, then we obtain convincing evidence to reject the null hypothesis.

```{r}
police_killings <- police_killings %>%
  mutate(black_hispanic = case_when(
    raceethnicity == "Black" ~ "B/H",
    raceethnicity == "Hispanic/Latino" ~ "B/H",
    raceethnicity == "White" ~ "W"
  ))  

p_hat <- police_killings %>%
  specify(h_income ~ black_hispanic) %>%
  calculate(stat = "diff in means", order = c("W", "B/H")) 
  

killings_boot <- police_killings %>%
  specify(h_income ~ black_hispanic) %>%
  generate(reps = 10000, type = "bootstrap") %>%
  calculate(stat = "diff in means", order = c("W", "B/H")) 
percentile_ci <- get_ci(killings_boot, level = 0.95)

visualize(killings_boot) +
  shade_confidence_interval(endpoints = percentile_ci) + 
  labs(title = "Race/Ethnicity Difference in Means Distribution for Household Income", 
  x = "Race/Ethnicity", y = "Household Income") +
  theme_bw()

p_hat
percentile_ci
```

justify the choice of statistical method(s) used to answer your research question

##### Sub-question 3): College, Unemployment, & Race/Ethnicity

The third demographic relationship we want to investigate is the relationship between college graduation and unemployment rates for each race/ethnicity, to determine if there is a correlation between these variables amongst those have been killed by the police. 

*Methodology*
First, we want to visualize the relationship between college graduation and unemployment rate, so we make a plot of those variables with the points colored by race/ethnicity.
```{r}
p <- ggplot(police_killings, aes(x = college, y = urate, color = raceethnicity)) +
  geom_point() + 
  labs(title = "Relationship Between College Graduation and Unemployment Rate",
        x = "Proportion Graduated from College", y = "Unemployment Rate") + 
        scale_color_viridis(discrete=TRUE, option = "D", name="Race/Ethnicity")
p
```
Here, we can clearly see that the higher unemployment rates happen at the lower college graduation rates across all races/ethnicities. Additionally, the distribution of colors suggests that, unlike our hypothesis, the graduation rates for white people are not lower than those of the other ethnicities. What we can observe, though, is that the highest unemployment rates amongst those killed by the police are in counties where people Black or Asian/Pacific Islander race/ethnicity live.

In order to quantify the relationship observed in our visualization, we can find the correlation between college graduation and unemployment rates.
```{r}
police_killings %>%
  summarize(cor(college, urate))
```
```{r}
boot_corr <- police_killings %>% 
  specify(college ~ urate) %>% 
  generate(reps = 10000, type = "bootstrap") %>% 
  calculate(stat = "correlation") 
  
ci_corr <- get_ci(boot_corr, level = .99)
ci_corr
```

justify the choice of statistical method(s) used to answer your research question

### RESULTS/DISCUSSION

## Sub-question 1
Result:
From hypothesis testing, we obtain a t-stats of 19.5 and a p-value of 1.285552e-85, almost zero, way smaller than 0.05. This means that we are confident to reject the null hypothesis at 95% confidence level.
From visualization, we see that it is indeed men who takes up the largest proportion of cases killed by police, which echoes with the result from CLT-based hypothesis testing.

## Sub-question 2
Result:
From simulation, we get a 95% confidence interval from 3413 to 10901. It does not have value lower than 0. It means that we reject null hypothesis that the household incomes of White individuals who were killed by police are the same as Black & Hispanic victim. 

## Sub-question 3
We observe a correlation of -0.474 between college graduation and unemployment rates, which is a moderate correlation. We are 99% confident that the true correlation between heat and humidity is between -0.54 to -0.405.
This lines up with our visualization and suggests that although the correlation is not the strongest, it is not negligible and has implications on the demographic of people more often killed by the police.

## Running a Linear Model and Testing Fit
```{r}
model_1 <- lm(h_income ~ raceethnicity + gender, data = police_killings)
model_1 %>%
  tidy() %>%
  select(term, estimate)
```
someone add in the linear model and an interpretation of this linear model

We can test our regression model for household income... fill out this description
```{r}
model_1_aug <- augment(model_1)
model_1_aug
```
INDEPENDENCE
```{r}
ggplot(data = model_1_aug, 
       aes(x = 1:nrow(police_killings), 
           y = .resid)) + 
  geom_point() + 
  labs(x = "Index", y = "Residual", title = "Independence Plot")
```
EQUAL VARIANCE AND LINEARITY:
```{r}
ggplot(model_1_aug, mapping = aes(x= .fitted, y= .resid)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, lwd =2, col = "blue", lty =2) +
  labs(x = "Predicted Count", y = "Residuals", title = "Variance and Linearity Plot")
```
NORMALITY

```{r}
ggplot(model_1_aug, mapping = aes(x = .resid)) +
  geom_histogram(bins = 15) + 
  labs(x = "Residuals", title = "Normality Histogram")

ggplot(model_1_aug, mapping = aes(sample = .resid)) +
  stat_qq() + 
  stat_qq_line() +
  labs(title = "Normality Q-Q Plot")
```
ASSESS THESE FACTORS (it's in the notes and also the exam how to interpret, and make conclusions based on that)

### DISCUSSION

This section is a conclusion and discussion. This will require a summary of what you have learned about your research question along with statistical arguments supporting your conclusions. You should critique your own methods and provide suggestions for improving your analysis and future work. Issues pertaining to the reliability and validity of your data and the appropriateness of the statistical analyses should also be discussed. Also include a brief paragraph on what you would do differently if you were able to start over with the project.

- re-state our conclusions from the results section, and say what this understanding speaks about broader context (men from lower socio-economic status and POC have higher occurrences of killings, what does mean etc)
- critiquing methods - only includes certain variables and does not consider other types of effects; data only from half of a year so not super generalizable;
- what we would do differently - consider variables regarding geogrphy and see if they have any correlation to what we are testing for (because geographic location also part of demography)
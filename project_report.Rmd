---
title: "Project Report"
author: "Devanshi, Chinmay, Archie"
date: "4/23/2021"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(infer)
library (readr)
library(sf)

```
### INTRODUCTION AND DATA
##### Background and Motivation
The American police force is notorious for needlessly beating and killing. Moreover, such killings and mistreatment tend to disproportionately impact Black Americans and other poc groups. In May of 2020, the issue again sparked outrage, as the nation watched policeman Derek Chauvin kill George Floyd on video. The event brought discussion on the impacts of police brutality, particularly on communities of color, to a national spotlight. Our research study will analyze which communities and groups of people are most impacted by police killings. 

##### Dataset in question
The data overviews the demographics of individuals killed by police in the United States. This data was collected from The Guardian’s database on police killings, and census data from the American Community Survey. The Guardian’s database data was collected through verified crowdsourcing. The data was collected in 2015, and was used in the FiveThirtyEight article “Where Police Have Killed Americans in 2015.” The data is posted to the github page “fivethirtyeight/data” and can be found by the link. Relevant variables in the dataset include raceethnicity : Race/ethnicity of deceased, state : State where incident occurred, share_white : share of population that is nonhispanic / white, share_bloack: share of population that is black, month: month of killing.

### Research Question and Hypothesis

GENERAL QUESTION: How do demographic factors differ among those who have been killed by the police?

### Glimpse of Dataset:
Dataset: https://github.com/fivethirtyeight/data/tree/master/police-killings 
background reading: https://www.nytimes.com/2020/05/31/us/george-floyd-investigation.html 
```{r}
urlfile="https://raw.githubusercontent.com/fivethirtyeight/data/master/police-killings/police_killings.csv"
police_killings<-read_csv(url(urlfile))
police_killings <- police_killings %>% 
  mutate(urate = urate *100, college = college *100, pov = as.numeric(pov))
glimpse (police_killings)
```
##### Police killing cases by ethnicity
```{r}
police_killings <- police_killings %>%
drop_na

police_killings %>%
group_by(raceethnicity) %>%
  summarise(count = n())
```
*spatial data make a map

#### USA Map of Police Killings

### METHODOLOGY & RESULTS
```{r policekillings_map}
police_killings_df <- read.csv("https://raw.githubusercontent.com/fivethirtyeight/data/master/police-killings/police_killings.csv")
str(police_killings_df)

police_killings_sf <- st_as_sf(police_killings_df, coords = c("latitude", "longitude"))
str(police_killings_sf)

st_crs(police_killings_sf) <- 4326 
st_crs(police_killings_sf)

st_write(police_killings_sf, "data/police_killings", driver = "ESRI Shapefile")
st_write(police_killings_sf, "data/police_killings", driver = "ESRI Shapefile", delete_layer = TRUE)

  
```


https://cengel.github.io/R-spatial/intro.html

##### 1) Household income by ethnicity
*Research Question*
Among those who were killed by police, are the household incomes of White individuals greater than Black & Hispanic individuals?

Null Hypothesis: The household incomes of White individuals who were killed by police are not greater than Black & Hispanic individuals who were killed by police.
Alternate Hypothesis: The household incomes of White individuals who were killed by police are greater than Black & Hispanic individuals who were killed by police.

*Methodology*
To answer the research question, we constructed a 95% simulation based confidence interval. We use functions from the "infer" package to create 10,000 bootstrap simulation, calculate bootstrap stats "differences in means" , and construct a 95% confidence interval of difference of mean household income between white and non-white victims (h_income_white - h_income_B/H). To visualize the confidence interval and bootstrap distribution, we use visualize() & shade_confidence_interval() function. If the confidence interval on the plot captures zero, it means that we cannot rule out the possibility that household income of white people maybe lower than that of black&hispanic people and thus we fail to reject our null hypothesis. If the entire confidence interval is consistently positive, then we obtain convincing evidence to reject the null hypothesis.

*Results*
```{r}
police_killings <- police_killings %>%
  mutate(black_hispanic = case_when(
    raceethnicity == "Black" ~ "B/H",
    raceethnicity == "Hispanic/Latino" ~ "B/H",
    raceethnicity == "White" ~ "W"
  ))  

p_hat <- police_killings %>%
  specify(h_income ~ black_hispanic) %>%
  calculate(stat = "diff in means", order = c("W", "B/H")) 
  

killings_boot <- police_killings %>%
  specify(h_income ~ black_hispanic) %>%
  generate(reps = 10000, type = "bootstrap") %>%
  calculate(stat = "diff in means", order = c("W", "B/H")) 
percentile_ci <- get_ci(killings_boot, level = 0.95)

visualize(killings_boot) +
  shade_confidence_interval(endpoints = percentile_ci) + 
  labs(title = "Race/Ethnicity Difference in Means Distribution for Household Income", 
  x = "Race/Ethnicity", y = "Household Income") +
  theme_bw()

p_hat
percentile_ci
```

From simulation, we get a 95% confidence interval from 3413 to 10901. It does not have value lower than 0. It means that we reject null hypothesis that the household incomes of White individuals who were killed by police are the same as Black & Hispanic victim. 

##### 2): Killing cases by GENDER
*Research Question*
Are men more likely to be killed by police? 
Null hypothesis: The proportion of male victims among police killing cases is not greater than 50%.
Alternative hypothesis: The proportion of male victims among police killing cases is greater than 50%.
*Methodology*
To answer the research question, we use Central Limit Theorem Based Hypothesis Testing. We use "prop_test" function from the "infer" package to test if the proportion of male victims is greater than 50%. If the p-value of it being less than 50% is smaller than 0.05, we have convincing evidence to reject the null hypothesis. If the p-value is greater than 0.05, then we fail to reject the null hypothesis. To make the p-value represent that of < 50%, we input alternative to be "greater" in the prop_test. We created a segmented bar plot to visualize the total men and women killed by police in each ethnicity group. Gendered is represented by color.

```{r}
police_killings %>% 
  mutate(better = ifelse(gender == "Male", "better", "worse")) %>% 
  prop_test(response = better, success = "better", conf_int = FALSE, p = 0.5,
            alternative = "greater", z = TRUE)
```

```{r}
library(viridis)
ggplot(data = police_killings, mapping = aes(x = raceethnicity, fill = gender)) + 
  geom_bar() +
  coord_flip() + 
  scale_fill_viridis(discrete=TRUE, option = "D", name="gender") +
  labs(main= "Gender Distribution of Race/Ethnicity", x= "Race/Ethnicity", y="Count") +
  theme_bw()
```
Result:
From hypothesis testing, we obtain a t-stats of 19.5 and a p-value of 1.285552e-85, almost zero, way smaller than 0.05. This means that we are confident to reject the null hypothesis at 95% confidence level.
From visualization, we see that it is indeed men who takes up the largest proportion of cases killed by police, which echoes with the result from CLT-based hypothesis testing.


##### Research Question 3): College, Unemployment, & raceethnicity
*Methodology*
To analyze the how percentage of college education, unemployment, and poverty rate influences the count of police shooting happening in that county, we would run a linear regression model whose response variable is number of police shooting cases by county and the three explanatory variables are "college", "urate", and "pov". The number of police shooting cases by county is not offered in the original dataset and we mutate it in the first code chunk. The "urate" variable is not on scale of 1-100 and we also need to change it before running regression,

```{r}
killings_by_community <- police_killings %>% 
  group_by(county_id) %>% 
  summarise(count = n(), college, urate, pov)
killings_by_community <- killings_by_community %>% 
  group_by(county_id) %>% 
  summarise(count, college = median(college), urate = median (urate), pov = median(pov)) %>% 
  distinct()
```

```{r}
model_1 <- lm(count ~ college + urate + pov, data = killings_by_community)
model_1 %>%
  tidy() %>%
  select(term, estimate)
```


```{r}
police_killings %>%
  summarize(cor(college, urate))
```

```{r}
p <- ggplot(police_killings, aes(x = college, y = urate, color = raceethnicity)) +
  geom_point() + 
  labs(title = "Relationship Between College Graduation and Unemployment Rate",
        x = "Proportion Graduated from College", y = "Unemployment Rate") + 
        scale_color_viridis(discrete=TRUE, option = "D", name="Race/Ethnicity")
p
```

talk about cluster at  left  where we see low college and high unemployment, talk about obs by race
conclude that much fewer people killed came from areas where people got secondary education and had low unemployment; we see correlation between those who were killed and lower levels of ed/higher unemployment


```
^we can do linear regression to determine predictors of poverty rate and then assess them like we did in exam 2
